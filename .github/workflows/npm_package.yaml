name: npm_package
on:
  workflow_call:
    inputs:
      upload-assets:
        required: false
        type: boolean
    outputs:
      artifact-id:
        value: ${{ jobs.npm-package.outputs.artifact-id }}

permissions:
  contents: read

jobs:
  npm-package:
    runs-on: ubuntu-24.04
    outputs:
      artifact-id: ${{ steps.upload.outputs.artifact-id }}
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
      - uses: ./.github/actions/setup
        with:
          skip-go: 'true'
      - run: npm pack
      - id: upload
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        with:
          name: npm-package
          path: go-text-template-napi-*.tgz
      - run: gh release upload '${{ github.ref_name }}' go-text-template-napi-*.tgz
        if: inputs.upload-assets
        env:
          GH_TOKEN: ${{ github.token }}
